# virtual function


<p align="center">
  <img src="https://img-my.csdn.net/uploads/201204/16/1334508382_5947.jpg"/>
</p>

当在用父类的引用或者指针调用虚函数时，会先从该对象的头部取到虚函数的地址（C++标准规定虚函数表地址必须放最前），再从虚函数表中取到实际要调用的函数的地址，最终调用该函数
虚函数，相比普通函数，实际上多了三条汇编指令（取虚表，取函数地址，call调用）。

至于虚函数如何影响cpu的流水线(pipeline)，则主要是因为call指令

虚函数调用效率和继承层数无关；
其实虚函数还是挺快的。
如果真的要完全移除虚函数，那么如果要实现运行时多态，则要用到函数指针

## 虚函数慢的原因主要有三个：

多了几条汇编指令（运行时得到对应类的函数的地址）
影响cpu流水线(pipeline)
编译器不能内联优化（仅在用父类引用或者指针调用时，不能内联）
